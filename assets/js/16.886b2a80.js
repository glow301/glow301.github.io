(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{509:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("记得我在开始学习 docker 的时候，在网上查找各种教程，最后不是被复杂的命令劝退就是看着一头雾水。最后还是耐心看着"),a("a",{attrs:{href:"https://docs.docker.com/get-started/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("才算是入门。也许是我的理解能力比较弱，不过很多教程在读者对 docker 还一知半解的时候，上来就告诉你怎么写 dockerfile，列出一大堆命令，确实会令很多新手望而生畏。")]),s._v(" "),a("h2",{attrs:{id:"docker-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-是什么"}},[s._v("#")]),s._v(" Docker 是什么")]),s._v(" "),a("p",[s._v("用一句话说，docker 是一个为应用提供运行时的平台。")]),s._v(" "),a("p",[s._v("举个例子，一个 APP 可以运行在 IOS 平台，也可以运行在 Android 平台，这个 IOS，Andorid 就是提供应用运行的平台。类似，docker 也是一个提供应用运行的平台，你也可以把 docker 当成一个轻量级的虚拟机。")]),s._v(" "),a("h3",{attrs:{id:"docker-engine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-engine"}},[s._v("#")]),s._v(" Docker Engine")]),s._v(" "),a("p",[s._v("docker 采用 client-server 的模式。docker-daemon 充当 server 的角色，docker-cli 充当 client 的角色，他们之间通过 REST API 通信。你可以认为 docker-daemon 相当于 mysqld，docker-clien 相当于 mysql-client。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/docker/docker-engine.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"docker-的工作方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-的工作方式"}},[s._v("#")]),s._v(" Docker 的工作方式")]),s._v(" "),a("p",[s._v("在谈论 docker 的工作方式之前，我们先来想一下，如果你需要在自己电脑上安装一个 win10 的虚拟机，你会怎么做？")]),s._v(" "),a("ol",[a("li",[s._v("去微软官网")]),s._v(" "),a("li",[s._v("下载 win10 镜像到本地")]),s._v(" "),a("li",[s._v("安装")])]),s._v(" "),a("p",[s._v("docker 的工作方式其实和你去微软官网下 win10 镜像安装差不多。只是这里的“微软官网”需要换成 docker registries。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/docker/docker-flow.png",alt:""}})]),s._v(" "),a("p",[s._v("如果你要在本地运行一个 docker 容器，那么你只需要用到 "),a("code",[s._v("docker-pull")]),s._v(" 和 "),a("code",[s._v("docker-run")]),s._v(" 这两个命令。")]),s._v(" "),a("h3",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("上面我们已经大致了解到了 docker 的工作方式。简单来说就是拉取镜像，运行容器。从上面的图中可以看出主要有 "),a("code",[s._v("registries")]),s._v(", "),a("code",[s._v("image")]),s._v(" 和 "),a("code",[s._v("container")]),s._v(" 三个主要概念。")]),s._v(" "),a("h4",{attrs:{id:"仓库-docker-registries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仓库-docker-registries"}},[s._v("#")]),s._v(" 仓库（docker registries）")]),s._v(" "),a("p",[s._v("docker registries 是一个存放 docker 镜像的地方。最大的 docker 公有仓库是 "),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker hub"),a("OutboundLink")],1),s._v("。docker hub 是一个类似 github 的平台，只不过它托管的是 docker 镜像。docker hub 上都是别人已经构建好的镜像，我们在后面说如何构建自己的镜像。")]),s._v(" "),a("h4",{attrs:{id:"镜像-docker-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像-docker-image"}},[s._v("#")]),s._v(" 镜像（docker image）")]),s._v(" "),a("p",[s._v("镜像是一个只读的模板。你可以对比从微软官网下的 iso 镜像文件，是一个只读的文件。docker 镜像的作用只有一个，那就是构建容器。")]),s._v(" "),a("p",[s._v("我们可以通过命令 "),a("code",[s._v("docker images")]),s._v(" 查看本地镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker images\nREPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE\nmysql                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v("                 718a6da099d8        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         448MB\ngcr.io/k8s-minikube/kicbase   v0.0.11             e3ca409c7daf        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         953MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("关于 docker 镜像，另一点你需要了解的是，它是分层构建的。就像盖房子一样，新的一层总是在前一层的基础上。由于镜像是只读的，所以我们需要每一层尽可能小。如果你在某一层引入了一些不需要的东西，它们会被一起带到下一层，从而导致镜像文件很大。")]),s._v(" "),a("p",[s._v("还有一点需要说明的是，尽量使用现有的镜像，而不是自己从头开始构建一个。比如你需要一个 node 运行环境，就不需要先装一个 ubuntu 再安装 node。")]),s._v(" "),a("h4",{attrs:{id:"容器-docker-container"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器-docker-container"}},[s._v("#")]),s._v(" 容器（docker container）")]),s._v(" "),a("p",[s._v("容器是应用真正运行的地方。容器拥有各自独自的运行环境，互相隔离。就像你手机上的每一个 APP，微信崩溃不会影响到支付宝。")]),s._v(" "),a("p",[s._v("我们通过镜像来运行容器，每一个容器可以理解为一个实例。你可以通过一个镜像启动一个容器，也可以通过一个镜像启动多个容器。")]),s._v(" "),a("p",[s._v("在一个容器中可以运行一个应用，也可以运行多个应用。一般为了方便管理，我们都会选择在每一个容器中运行一个应用。")]),s._v(" "),a("p",[s._v("可以通过命令 "),a("code",[s._v("docker ps")]),s._v(" 查看正在运行的容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES\nef015d798237        mysql:5.7           "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" days ago         Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" hours         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp   mysql-5.7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"docker-能做什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-能做什么"}},[s._v("#")]),s._v(" Docker 能做什么")]),s._v(" "),a("p",[s._v("docker 的用处，有兴趣的话，可以看"),a("a",{attrs:{href:"https://docs.docker.com/get-started/overview/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网介绍"),a("OutboundLink")],1),s._v("。这里我个人理解有这么几种场景吧。")]),s._v(" "),a("ul",[a("li",[s._v("方便部署\n"),a("ul",[a("li",[s._v("docker 提供了统一，独立，隔离的环境。对于运维来说，只需要把 docker 镜像放到机器上运行就可以了。从而省去了很多环境依赖的问题。")])])]),s._v(" "),a("li",[s._v("安装软件\n"),a("ul",[a("li",[s._v("相信大家都遇到过，安装了一个软件，删除的时候，发现删不干净的问题。如果通过 docker 安装的话，删除的时候只要删掉容器，所有的内容都会被删除。")])])])]),s._v(" "),a("h2",{attrs:{id:"一个简单的例子-用-docker-运行-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一个简单的例子-用-docker-运行-redis"}},[s._v("#")]),s._v(" 一个简单的例子，用 docker 运行 redis")]),s._v(" "),a("p",[s._v("下面我们通过一个简单的例子，通过 docker 启动一个 redis。和之前的不皱一样，先从 docker registries 上拉取镜像，然后本地运行。")]),s._v(" "),a("h3",{attrs:{id:"查看可用镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看可用镜像"}},[s._v("#")]),s._v(" 查看可用镜像")]),s._v(" "),a("p",[s._v("我们先通过 "),a("code",[s._v("docker search redis")]),s._v(" 命令，看一下 docker registries 上面都有哪些镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker search redis\nNAME                             DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nredis                            Redis is an "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" key-value store that…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8580")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbitnami/redis                    Bitnami Redis Docker Image                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("161")]),s._v("                                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsameersbn/redis                                                                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ngrokzen/redis-cluster            Redis cluster "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("71")]),s._v("\nrediscommander/redis-commander   Alpine image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" redis-commander - Redis man…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkubeguide/redis-master           redis-master with "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!"')]),s._v("                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("\nredislabs/redis                  Clustered in-memory database engine compatib…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("\nredislabs/redisearch             Redis With the RedisSearch module pre-loaded…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\noliver006/redis_exporter          Prometheus Exporter "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis Metrics. Supp…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\narm32v7/redis                    Redis is an "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" key-value store that…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("\nredislabs/rejson                 RedisJSON - Enhanced JSON data "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" processi…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\nbitnami/redis-sentinel           Bitnami Docker Image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis Sentinel         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nredislabs/redisinsight           RedisInsight - The GUI "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\nwebhippie/redis                  Docker images "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis                         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nredislabs/redisgraph             A graph database module "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ns7anley/redis-sentinel-docker    Redis Sentinel                                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ninsready/redis-stat              Docker image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the real-time Redis monitor…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\narm64v8/redis                    Redis is an "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" key-value store that…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\nredislabs/redismod               An automated build of redismod - latest Redi…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncentos/redis-32-centos7          Redis in-memory data structure store, used a…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\ncircleci/redis                   CircleCI images "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Redis                       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nclearlinux/redis                 Redis key-value data structure server with t…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nwodby/redis                      Redis container image with orchestration        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntiredofit/redis                  Redis Server w/ Zabbix monitoring and S6 Ove…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nxetamus/redis-resource           forked redis-resource                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("带有 "),a("code",[s._v("OFFICIAL")]),s._v(" 说明是官方镜像，我们就用官方镜像。")]),s._v(" "),a("h3",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("docker pull redis")]),s._v(" 命令拉取最新镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker pull redis\nUsing default tag: latest\nlatest: Pulling from library/redis\na6d76de28f58: Downloading "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                                                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("262")]),s._v(".1kB/25.85MB\n3573263a91cd: Download complete\n74acfbcef883: Downloading "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("920")]),s._v(".8kB/1.353MB\n720e1be7fe14: Downloading "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(".3kB/9.538MB\nbcb81e952db9: Waiting\nfa95093de04d: Waiting\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("从上面的结果，我们可以看到两点")]),s._v(" "),a("ol",[a("li",[s._v("如果不指定 tag，将使用 latest，也就是最新的 tag。")]),s._v(" "),a("li",[s._v("镜像的拉取是分层的，也刚好应证了我们说镜像是分层构建的。")])]),s._v(" "),a("h3",{attrs:{id:"运行容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行容器"}},[s._v("#")]),s._v(" 运行容器")]),s._v(" "),a("p",[s._v("我们先用 "),a("code",[s._v("docker images")]),s._v(" 命令来看一下本地的镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nredis               latest              b2df71f4042b        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v(".4MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以看到，我们刚刚拉取下来的 redis 镜像已经可以看到了。")]),s._v(" "),a("p",[s._v("接下来我们通过 "),a("code",[s._v("docker run")]),s._v(" 命令来启动 redis")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(":6379 -d redis:latest\n479de2aabe50de2a4cfdf3e9d26690cec2ba19e23ec4256d01cf4ca83303a3e5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("-p 6379:6379")]),s._v(" 表示把本地的 6379 端口映射到容器的 6379 端口上。我们需要通过网络访问 redis，就需要设置端口映射。")]),s._v(" "),a("li",[a("code",[s._v("-d")]),s._v(" 表示以 detach 方式运行，也就是后台运行。")]),s._v(" "),a("li",[a("code",[s._v("redis:latest")]),s._v(" 表示镜像的名字和版本号。")])]),s._v(" "),a("p",[s._v("这个时候我们通过 "),a("code",[s._v("docker ps")]),s._v(" 命令就可以查看到已经启动的 redis")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n479de2aabe50        redis:latest        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago       Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:6379-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp   hardcore_thompson\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以注意到:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("CONTAINER ID")]),s._v(" 就是我们运行完 "),a("code",[s._v("docker run")]),s._v(" 之后返回的那一串字符串的前几位。")]),s._v(" "),a("li",[s._v("PORTS 字段表示本机 6479 端口通过 TCP 映射到容器的 6379 端口。")]),s._v(" "),a("li",[s._v("因为我们没有给容器起名，所以 NAMES 是自动生成的一个 name。")])]),s._v(" "),a("p",[s._v("我们来测试一下 redis 是不是可以正常使用了。\n因为本机没有安装过 redis，自然也无法使用 redis-cli。因为 redis 使用的是文本协议，所以我们可以通过 telnet 方式来访问 redis。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ telnet "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nTrying "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nConnected to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1.\nEscape character is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^]'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\nSET key1 value1\n+OK\nGET key1\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$6")]),s._v("\nvalue1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("可以看到，redis 工作正常。")]),s._v(" "),a("h3",{attrs:{id:"停止容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止容器"}},[s._v("#")]),s._v(" 停止容器")]),s._v(" "),a("p",[s._v("假设现在你已经不需要 redis 了，可以使用命令 "),a("code",[s._v("docker stop")]),s._v(" 命令停止当前正在运行的容器。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker stop 479de2aabe50\n479de2aabe50\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("后面的 id 就是用 "),a("code",[s._v("docker ps")]),s._v(" 看到的 "),a("code",[s._v("CONTAINER ID")]),s._v("。当然，你也可以通过容器名来停止容器，就像这样。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker stop hardcore_thompson\nhardcore_thompson\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这时，通过 "),a("code",[s._v("docker ps")]),s._v(" 已经看不到刚才的容器了，因为 "),a("code",[s._v("docker ps")]),s._v(" 查看的是正在运行的容器。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意，这里停止容器之后，容器还没有从我们的电脑中删除，可以通过 "),a("code",[s._v("docker ps -a")]),s._v(" 查看所有容器。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES\n479de2aabe50        redis:latest        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" hours ago        Exited "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" minutes ago                       hardcore_thompson\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除容器"}},[s._v("#")]),s._v(" 删除容器")]),s._v(" "),a("p",[s._v("如果容器已经不再需要，我们就可以通过 "),a("code",[s._v("docker rm")]),s._v(" 命令将容器从电脑中删除。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 479de2aabe50\n479de2aabe50\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("现在再用 "),a("code",[s._v("docker ps -a")]),s._v(" 就看不到任何容器了。但是 redis 的镜像还在本机。这是为了方便下次启动 redis，不需要在联网拉取。")]),s._v(" "),a("p",[s._v("如果需要删除镜像，可以使用 "),a("code",[s._v("docker rmi")]),s._v(" 命令。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[s._v("在使用 "),a("code",[s._v("docker rmi")]),s._v(" 删除镜像前，一定要确保当前镜像已经没有容器使用了，包括已经停止的容器。换句话说，你需要先删除所有相关的容器，才可以删除镜像。")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker rmi b2df71f4042b\nError response from daemon: conflict: unable to delete b2df71f4042b "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("must be forced"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" - image is being used by stopped container d368fe03ec13\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在停止所有相关容器之后，再执行 "),a("code",[s._v("docker rmi")]),s._v(" 命令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker rmi b2df71f4042b\nUntagged: redis:latest\nUntagged: redis@sha256:1cfb205a988a9dae5f025c57b92e9643ec0e7ccff6e66bc639d8a5f95bba928c\nDeleted: sha256:b2df71f4042bb12cbf0c22820ff3e74a101502b918a21e50475ab30c33172efc\nDeleted: sha256:e01b786769f9b2c0546c1576b5260f266cc7423216df576d9ed7b6586591cb87\nDeleted: sha256:a8c664e8618ed88349714b4531b0ff610adb0e32e34570c09f6065d2a14f98e2\nDeleted: sha256:7493a598df96002af333e859cb0a50feab2af2ff766790103ea64e496ff50ebd\nDeleted: sha256:1eaa3b2d5166d76189f5d55d8bfa6d011e6cfe50f34bbcc661b3c662b06b53a7\nDeleted: sha256:b327b2b3321a8aa5d57e2acf88a48ae7e5325791dc6a7b029e174f2f61b7bdf6\nDeleted: sha256:e829239188f8526355147849a4e8a5f915adb31c5a389977c79a0137787bc46a\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("再次应证了镜像是分层构造的。")]),s._v(" "),a("h2",{attrs:{id:"将-docker-应用到自己的应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-docker-应用到自己的应用"}},[s._v("#")]),s._v(" 将 docker 应用到自己的应用")]),s._v(" "),a("p",[s._v("到目前为止，我们用到的都是别人已经构建好的镜像，接下来我们讨论一下如何自己构建一个镜像。")]),s._v(" "),a("p",[s._v("假设我们现在有一个 nodejs 的应用，它只是一个很简单的 http 服务器，当我们访问时，返回 "),a("code",[s._v("Hello docker")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/plain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello Docker\\n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("我们在 8888 端口启动了一个简单的 http 服务器。可以简单测试一下是否可以正常工作。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8888\nHello Docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"添加-dockerfile-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加-dockerfile-文件"}},[s._v("#")]),s._v(" 添加 Dockerfile 文件")]),s._v(" "),a("p",[s._v("现在你打算在另一台电脑上运行这个程序，但是不幸的是，新的电脑上并没有安装 node。现在你有两种选择。")]),s._v(" "),a("ol",[a("li",[s._v("在这台电脑上安装 node。")]),s._v(" "),a("li",[s._v("使用 docker。")])]),s._v(" "),a("p",[s._v("下面我们通过 docker 的方式来运行程序。")]),s._v(" "),a("p",[s._v("假设你的目录下只有一个 "),a("code",[s._v("app.js")]),s._v(" 文件，就像这样。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\napp.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("创建一个空文件，命名为 "),a("code",[s._v("Dockerfile")]),s._v("，没有任何扩展名。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" Dockerfile\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后把下面这段代码复制到 "),a("code",[s._v("Dockerfile")]),s._v(" 中。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("14"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g nodemon\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8888\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodemon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("关于这段代码是什么意思，我们等下再做说明，先复制粘贴就好。")]),s._v(" "),a("h3",{attrs:{id:"构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("p",[s._v("现在，我们在当前目录下执行 "),a("code",[s._v("docker build -t myapp:dev .")]),s._v(" 命令。开始构建镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker build -t myapp:dev "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nSending build context to Docker daemon  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".072kB\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM node:14-alpine\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("-alpine: Pulling from library/node\n29e5d40040c1: Pull complete\n0ec0f9965308: Pull complete\nfb4a33214bdd: Pull complete\n5f9b63cc7190: Pull complete\nDigest: sha256:f7c6c13cd2b18c58acc1eb4ca9135468c1ab42beba34102fc25b2d512a517fbb\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" node:14-alpine\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 4b619cec969f\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" WORKDIR /app\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" c0be98cd227d\nRemoving intermediate container c0be98cd227d\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 608ba5ecad5f\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /app\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" c1d5add165e1\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" EXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" d8789c7c5a8a\nRemoving intermediate container d8789c7c5a8a\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ef962be3b4d6\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/5 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodemon"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Running "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 032e965e39c9\nRemoving intermediate container 032e965e39c9\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 9da615f1d959\nSuccessfully built 9da615f1d959\nSuccessfully tagged myapp:dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("可以看到，这里和上面我们拉取 redis 非常相似，只是这里变成了 node 而已。")]),s._v(" "),a("h3",{attrs:{id:"运行容器-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行容器-2"}},[s._v("#")]),s._v(" 运行容器")]),s._v(" "),a("p",[s._v("我们先用 "),a("code",[s._v("docker images")]),s._v(" 命令来看一下本地的镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker image\nREPOSITORY          TAG                 IMAGE ID            CREATED              SIZE\nmyapp               dev                 9da615f1d959        About a minute ago   116MB\nnode                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("-alpine           4b619cec969f        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago           116MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("下面使用 "),a("code",[s._v("docker run")]),s._v(" 命令运行容器。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":8888 --name myfirstapp -d myapp:dev\ne600259433e7e5223e333dbc02c51e3f0ddac534de55fb053540969901bcd1b3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这样容器就已经启动好了，我们简单测试一下。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3000\nHello Docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("我们用 "),a("code",[s._v("docker ps")]),s._v(" 命令来看一下运行中的容器。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                    NAMES\ne600259433e7        myapp:dev           "docker-entrypoint.s…"   About a minute ago   Up About a minute   0.0.0.0:3000->8888/tcp   myfirstapp\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("现在，第一个容器化的应用就已经运行起来了。")]),s._v(" "),a("h3",{attrs:{id:"命令解释"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令解释"}},[s._v("#")]),s._v(" 命令解释")]),s._v(" "),a("h4",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("FROM node:14-alpine")]),s._v(" "),a("ul",[a("li",[s._v("FROM 表示这个镜像是基于 "),a("code",[s._v("node:14-appine")]),s._v(" 这个镜像的。每一个镜像都应该有一个基础镜像。")]),s._v(" "),a("li",[s._v("node:14-apline 表示指定 node 的版本是 14。")]),s._v(" "),a("li",[s._v("alpine 是 linux 的一个发行版，它的特点是体积很小，非常适合构建镜像。下面可以简单看一下 alpine 版本和普通版的大小对比。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nnode                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("-alpine           4b619cec969f        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          116MB\nnode                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("                  da105ecfd1bf        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" days ago          890MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("code",[s._v("WORKDIR /app")]),s._v(" "),a("ul",[a("li",[s._v("设置工作目录为 "),a("code",[s._v("/app")]),s._v("，这个 "),a("code",[s._v("/app")]),s._v(" 是容器中的目录。")])])]),s._v(" "),a("li",[a("code",[s._v("COPY . /app")]),s._v(" "),a("ul",[a("li",[s._v("将当前目录下的所有代码 copy 到容器的 "),a("code",[s._v("/app")]),s._v(" 目录。")])])]),s._v(" "),a("li",[a("code",[s._v("RUN npm install -g nodemon")]),s._v(" "),a("ul",[a("li",[s._v("nodemon 是 nodejs 开发工具，这里不用管它。")])])]),s._v(" "),a("li",[a("code",[s._v("EXPOSE 8888")]),s._v(" "),a("ul",[a("li",[s._v("暴露容器的 8888 端口。")])])]),s._v(" "),a("li",[a("code",[s._v('CMD ["node", "app.js"]')]),s._v(" "),a("ul",[a("li",[s._v("在容器中执行 "),a("code",[s._v("node app.js")]),s._v(" 命令。")])])])]),s._v(" "),a("h4",{attrs:{id:"docker-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-build"}},[s._v("#")]),s._v(" docker build")]),s._v(" "),a("p",[s._v("在定义好 Dockerfile 之后，我们就可以使用 "),a("code",[s._v("docker build")]),s._v(" 来构建镜像了。你可以理解为 docker build 就是按顺序执行 Dockerfile 中的代码。")]),s._v(" "),a("p",[s._v("这里我们只说一下 "),a("code",[s._v("-t")]),s._v(" 这个参数。"),a("code",[s._v("-t")]),s._v(" 表示 tag，即为当前的镜像打一个标签。镜像的名字和 tag 用冒号"),a("code",[s._v(":")]),s._v("分割。")]),s._v(" "),a("ul",[a("li",[s._v("node:14 表示镜像名为 node，标签是 14")]),s._v(" "),a("li",[s._v("redis:latest 表示镜像名为 redis, 标签是 latest")]),s._v(" "),a("li",[s._v("...")])]),s._v(" "),a("p",[s._v("在我们不指定 tag 的时候，默认会使用 latest。但是为了版本的统一，一般都会指定 tag。")]),s._v(" "),a("p",[s._v("最后要说的是，在 "),a("code",[s._v("docker build -t myapp:dev .")]),s._v(" 最后的这个"),a("code",[s._v(".")]),s._v("，这个"),a("code",[s._v(".")]),s._v("是不能省略的，它表示当前目录。")]),s._v(" "),a("h4",{attrs:{id:"docker-run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-run"}},[s._v("#")]),s._v(" docker run")]),s._v(" "),a("p",[a("code",[s._v("docker run -p 3000:8888 --name myfirstapp -d myapp:dev")]),s._v("\n在上面的命令中，我故意在宿主机和容器中使用了不同的端口号，为了方便区分顺序。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-p 3000:8888")]),s._v(" "),a("ul",[a("li",[s._v("将宿主机的 3000 端口映射到容器的 8888 端口。宿主机的端口在前，容器的端口号在后。")])])]),s._v(" "),a("li",[a("code",[s._v("--name myfirstapp")]),s._v(" "),a("ul",[a("li",[s._v("为容器指定一个名字，如果不指定的话，docker 会随机生成一个名字。")])])])]),s._v(" "),a("h3",{attrs:{id:"通过-vloume-实现动态更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-vloume-实现动态更新"}},[s._v("#")]),s._v(" 通过 vloume 实现动态更新")]),s._v(" "),a("p",[s._v("如果每次代码被修改了，都要重新构建镜像，那就太麻烦了。docker 提供了 volume 可以将宿主机的目录映射到容器中。")]),s._v(" "),a("p",[s._v("让我们重新运行一下容器，加上一个参数。\n"),a("code",[s._v("-v $(pwd):/app")]),s._v(" 表示将当前目录通过 volume 挂载到容器的 "),a("code",[s._v("/app")]),s._v(" 目录。这样我们的代码就可以在宿主机和容器间共享了。")]),s._v(" "),a("p",[a("code",[s._v("docker run -p 3000:8888 --name myfirstapp -v $(pwd):/app -d myapp:dev")])]),s._v(" "),a("p",[s._v("这时候再去修改 app.js，把 "),a("code",[s._v("Hello Docker")]),s._v(" 改一下，比如改成 "),a("code",[s._v("Hello Docker from volume")]),s._v("。然后再测试一下。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3000\nHello Docker from volumn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("可以看到返回的结果已经改变了。")]),s._v(" "),a("h2",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" docker-compose")]),s._v(" "),a("p",[s._v("到目前为止，docker 的基本使用已经介绍的差不多了。但是如果有多个容器需要启动，一个一个运行 docker run 就显得有点繁琐了。而且，每次很长的参数也不容易记住。这时候，docker-compose 就派上用场了。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker-compose"),a("OutboundLink")],1),s._v(" 是一个单机下管理多个容器的解决方案。集群下一般使用 Kubernetes 或者 docker-swarm。")]),s._v(" "),a("h3",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("p",[s._v("和 Dockerfile 类似，docker-compose 也是需要定义一个配置文件，默认情况下，命名为 "),a("code",[s._v("docker-compose.yml")]),s._v("。")]),s._v(" "),a("p",[s._v("回到上面 nodejs 的例子，我们来定义一个 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("dev\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myfirstapp\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nodemon app.js\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3000:8888'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<current directory>:/app"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("从字面上看，docker-compose 的配置文件和直接在命令行运行大同小异。只是通过配置文件的方式把命令参数记录了下来。")]),s._v(" "),a("ul",[a("li",[s._v("services\n"),a("ul",[a("li",[s._v("服务的列表")])])]),s._v(" "),a("li",[s._v("web\n"),a("ul",[a("li",[s._v("自定义的服务名。如果你的应用还需要依赖 redis，mysql 之类的，可以在与 web 平级的目录创建 redis, mysql 等配置。")])])]),s._v(" "),a("li",[s._v("image\n"),a("ul",[a("li",[s._v("基础镜像，我们之前已经通过 docker build 将应有构建成了镜像，所以直接从我们这个镜像启动就可以。")])])]),s._v(" "),a("li",[s._v("container_name\n"),a("ul",[a("li",[s._v("容器名，相当于 docker run 中的 --name。")])])]),s._v(" "),a("li",[s._v("command\n"),a("ul",[a("li",[s._v("容器中执行的命令，相当于 Dockerfile 中的 CMD。")])])]),s._v(" "),a("li",[s._v("restert: always\n"),a("ul",[a("li",[s._v("表示每次启动容器都会重新启动。")])])]),s._v(" "),a("li",[s._v("ports\n"),a("ul",[a("li",[s._v("指定宿主机和容器的端口映射关系。")])])]),s._v(" "),a("li",[s._v("volumes\n"),a("ul",[a("li",[s._v("指定宿主机和容器文件映射关系")])])])]),s._v(" "),a("p",[s._v("详细的参数可以参考 "),a("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker 官网"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),a("p",[s._v("现在我们来运行 "),a("code",[s._v("docker-compose up -d")]),s._v(" 启动容器（其中 "),a("code",[s._v("-d")]),s._v(" 表示以 detach 方式启动）。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker-compose up -d\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev_default"')]),s._v(" with the default driver\nCreating myfirstapp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("接下来测试一下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3000\nHello Docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后我们再修改 app.js 中的文件，把 "),a("code",[s._v("Hello Docker")]),s._v(" 改成 "),a("code",[s._v("Hello Docker-compose")]),s._v("，保存然后再次测试。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3000\nHello Docker-compose\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"关闭容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭容器"}},[s._v("#")]),s._v(" 关闭容器")]),s._v(" "),a("p",[s._v("如果想要关闭容器，使用 "),a("code",[s._v("docker-compose down")]),s._v(" 即可。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ docker-compose down\nStopping myfirstapp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nRemoving myfirstapp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nRemoving network dev_default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("ul",[a("li",[s._v("docker 为我们提供了一个独立，隔离的应用运行平台，我们可以通过 docker 方便的部署，安装应用。")]),s._v(" "),a("li",[s._v("通过在已有的项目中添加 "),a("code",[s._v("Dockerfile")]),s._v(" 将应用构建成镜像。")]),s._v(" "),a("li",[s._v("使用 docker-compose 在单机上管理多个容器。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);